## 学习简报 - 2025年7月8日

**总学习时长 (此期间合计)：** 约 7 小时

**学习课程/内容：** JavaScript 异步编程 - 阅读书籍《你不知道的 JS》 异步和 Promise 部分，手写 `Promise` 原理

**核心任务：通过从零开始、分阶段地实现一个Promise，深入理解JavaScript异步编程的核心机制。**

**完成内容与学习点：**

### **第一部分：`MyPromise` 实现规划与基础辨析**

在编码前，先对 `Promise` 的核心构成和实现路径进行了梳理，并对相关的JS基础概念进行了辨析。

1.  **`Promise` 整体设计蓝图规划:**
    *   明确了手写 `Promise` 的三大核心构成：**状态机** (`PENDING`, `FULFILLED`, `REJECTED`)、**执行器 (`executor`)** 的作用，以及**`.then()` 方法**的核心职责。
    *   制定了从 V1 (基础状态机) 到 V3 (链式调用) 的迭代开发路线图，确保了实现的步骤清晰、目标明确。

2.  **JavaScript 核心概念辨析:**
    *   **`class` 语法:** 通过与 Java `class` 的对比，深化了对 JavaScript 中 `class` 是**原型继承**的“语法糖”这一本质的理解，并辨析了两者在类型系统、构造函数、继承模型上的差异。
    *   **`pnpm`:** (`pnpm`, `npm`)，加深了对前端工具链的理解。

### **第二部分：手写 `MyPromise` 核心功能**

通过迭代开发的方式，逐步实现了一个符合 `Promise/A+` 核心规范的 `MyPromise`。

3.  **V1 & V2 - 状态机与异步支持:**
    *   **构造函数实现:** 使用 ES6 `class` 语法创建了 `MyPromise`，并在 `constructor` 中接收 `executor` 函数。理解了 `executor` 是如何通过接收内部的 `resolve`/`reject` 函数作为参数，来实现“控制反转”的。
    *   **状态管理:** 实现了状态的单向流转（状态凝固），并能正确处理 `executor` 中的同步异常。
    *   **异步回调机制:** 理解并实践了通过 `onFulfilledCallbacks` 和 `onRejectedCallbacks` 这两个数组，以**“发布-订阅”模式**来支持异步 `executor`。通过对 `forEach` 语法的复盘，厘清了回调函数从“暂存”到“被遍历执行”的完整流程。

4.  **V3 - 链式调用与 `_resolvePromise` 解析流程:**
    *   **`.then()` 返回新 `Promise`:** 重构了 `.then()` 方法，使其总是返回一个新的 `MyPromise` 实例，为链式调用提供了结构基础。
    *   **`_resolvePromise` 解析函数:** 设计并实现了这个核心的辅助函数，用于解析 `.then` 回调的返回值 `x`。
        *   **递归解析:** 通过对“为什么需要用 `.then` 获取 `y`”等问题的深入探讨，理解了通过**递归调用** `_resolvePromise` 来“解包”嵌套 `Promise` 的核心原理。
        *   **`thenable` 兼容性:** 实践了对拥有 `.then` 方法的 `thenable` 对象的兼容处理逻辑。通过对 `.call()` 方法的复习，理解了如何安全地调用不被信任的外部方法。
        *   **`called` 锁机制:** 实现了“保险锁”(`called` 标志)，以确保 `Promise` 的 `resolve/reject` 只被调用一次，增加了代码的健壮性。
    *   **值的穿透:** 学习并实现了为 `onFulfilled` 和 `onRejected` 提供默认函数（`value => value` 和 `reason => { throw reason }`）的机制，以确保 `Promise` 链的健壮性。

---
### 🤔 思考与心得

*   **“造轮子”的价值：** 手写 `Promise` 的过程，迫使我去思考每一个规范细节背后的“为什么”。对递归解析、`thenable` 兼容性、异步回调执行时机等问题的探究，让我对 JS 异步编程的理解更加深入。
*   **循序渐进的重要性：** 从 V1 到 V3 的迭代开发过程，让我体会到解决复杂问题需要将其拆解成一个个可管理的小目标。先搭建骨架，再处理异步，最后实现链式调用，这个过程让复杂的逻辑变得清晰可控。
*   **理论辨析加深理解：** 对 `class`、`pnpm` 等概念的辨析，虽然不直接服务于手写 `Promise` 的代码，但拓宽了我的技术视野，让我能从更高维度理解前端生态中的各种工具和思想。

---
### 🚀 后续计划

*   **JavaScript 内功巩固：** **(高优先级)** 完成“防抖”和“节流”这两个经典函数的**手写实现**。
*   **React 学习衔接：** **(高优先级)** 回到 React 的学习路径，系统性地学习 `useEffect` Hook，并将今天对 `Promise` 和 `async/await` 的深刻理解，应用到处理网络请求等异步副作用的实践中。
*   **项目重构：** 将“B站评论”案例重构为使用真实API数据和自定义Hook的现代化应用。